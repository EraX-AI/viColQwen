<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 540">
  <!-- Background -->
  <rect width="800" height="540" fill="#f9f9f9" />
  
  <!-- Title -->
  <text x="400" y="25" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">ViPolyQwen: Trimodal Architecture</text>
  
  <!-- Input Section -->
  <rect x="200" y="40" width="400" height="60" rx="5" ry="5" fill="#e1f5fe" stroke="#01579b" stroke-width="1.5" />
  <text x="400" y="55" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Input Processing</text>
  
  <!-- Inputs -->
  <rect x="220" y="65" width="100" height="25" rx="3" ry="3" fill="#b3e5fc" stroke="#01579b" stroke-width="1" />
  <text x="270" y="82" font-family="Arial" font-size="10" text-anchor="middle">Text Input</text>
  
  <rect x="350" y="65" width="100" height="25" rx="3" ry="3" fill="#b3e5fc" stroke="#01579b" stroke-width="1" />
  <text x="400" y="82" font-family="Arial" font-size="10" text-anchor="middle">Image Input</text>
  
  <rect x="480" y="65" width="100" height="25" rx="3" ry="3" fill="#b3e5fc" stroke="#01579b" stroke-width="1" />
  <text x="530" y="82" font-family="Arial" font-size="10" text-anchor="middle">Audio Input</text>
  
  <!-- Prefix Conditioning -->
  <rect x="200" y="115" width="400" height="45" rx="5" ry="5" fill="#e8f5e9" stroke="#1b5e20" stroke-width="1.5" />
  <text x="400" y="130" font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle">Prefix-Guided Conditioning</text>
  
  <rect x="220" y="140" width="360" height="15" rx="3" ry="3" fill="#c8e6c9" stroke="#1b5e20" stroke-width="1" />
  <text x="400" y="151" font-family="Arial" font-size="8" text-anchor="middle">&lt;text_pair&gt; | &lt;instr&gt; | &lt;ocr&gt; | &lt;vqa_single&gt; | &lt;vqa_multi&gt; | &lt;audio&gt;</text>
  
  <!-- Loss components box (LEFT SIDE) -->
  <g>
    <rect x="50" y="180" width="130" height="130" rx="5" ry="5" fill="#fff9c4" stroke="#f57f17" stroke-width="1.5" />
    <text x="115" y="195" font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle">Loss Components</text>
    <rect x="65" y="200" width="100" height="18" rx="3" ry="3" fill="#fff59d" stroke="#f57f17" stroke-width="1" />
    <text x="115" y="213" font-family="Arial" font-size="9" text-anchor="middle">ℒ(NCE)</text>
    <rect x="65" y="223" width="100" height="18" rx="3" ry="3" fill="#fff59d" stroke="#f57f17" stroke-width="1" />
    <text x="115" y="236" font-family="Arial" font-size="9" text-anchor="middle">ℒ(Triplet)</text>
    <rect x="65" y="246" width="100" height="18" rx="3" ry="3" fill="#fff59d" stroke="#f57f17" stroke-width="1" />
    <text x="115" y="259" font-family="Arial" font-size="9" text-anchor="middle">ℒ(MSE)</text>
    <rect x="65" y="269" width="100" height="18" rx="3" ry="3" fill="#fff59d" stroke="#f57f17" stroke-width="1" />
    <text x="115" y="282" font-family="Arial" font-size="9" text-anchor="middle">ℒ(Cos)</text>
  </g>
  
  <!-- Dynamic Loss box (RIGHT SIDE) -->
  <g>
    <rect x="620" y="180" width="130" height="130" rx="5" ry="5" fill="#fce4ec" stroke="#880e4f" stroke-width="1.5" />
    <text x="685" y="195" font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle">Dynamic Loss Selection</text>
    <rect x="635" y="200" width="100" height="18" rx="3" ry="3" fill="#f8bbd0" stroke="#880e4f" stroke-width="1" />
    <text x="685" y="213" font-family="Arial" font-size="9" text-anchor="middle">ℒ(text_pair)</text>
    <rect x="635" y="223" width="100" height="18" rx="3" ry="3" fill="#f8bbd0" stroke="#880e4f" stroke-width="1" />
    <text x="685" y="236" font-family="Arial" font-size="9" text-anchor="middle">ℒ(instr)</text>
    <rect x="635" y="246" width="100" height="18" rx="3" ry="3" fill="#f8bbd0" stroke="#880e4f" stroke-width="1" />
    <text x="685" y="259" font-family="Arial" font-size="9" text-anchor="middle">ℒ(ocr)</text>
    <rect x="635" y="269" width="100" height="18" rx="3" ry="3" fill="#f8bbd0" stroke="#880e4f" stroke-width="1" />
    <text x="685" y="282" font-family="Arial" font-size="9" text-anchor="middle">ℒ(vqa)</text>
    <rect x="635" y="292" width="100" height="18" rx="3" ry="3" fill="#f8bbd0" stroke="#880e4f" stroke-width="1" />
    <text x="685" y="305" font-family="Arial" font-size="9" text-anchor="middle">ℒ(audio)</text>
  </g>
  
  <!-- Encoder Section -->
  <rect x="200" y="175" width="400" height="120" rx="5" ry="5" fill="#fff3e0" stroke="#e65100" stroke-width="1.5" />
  <text x="400" y="190" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Modality-Specific Encoders</text>
  
  <!-- Three encoders side by side -->
  <rect x="220" y="200" width="100" height="80" rx="3" ry="3" fill="#ffe0b2" stroke="#e65100" stroke-width="1" />
  <text x="270" y="220" font-family="Arial" font-size="9" font-weight="bold" text-anchor="middle">Qwen2-VL Text</text>
  <text x="270" y="235" font-family="Arial" font-size="8" text-anchor="middle">Text Processing</text>
  <text x="270" y="250" font-family="Arial" font-size="8" text-anchor="middle">Hidden Size: 2048</text>
  
  <rect x="350" y="200" width="100" height="80" rx="3" ry="3" fill="#ffe0b2" stroke="#e65100" stroke-width="1" />
  <text x="400" y="220" font-family="Arial" font-size="9" font-weight="bold" text-anchor="middle">Qwen2-VL Vision</text>
  <text x="400" y="235" font-family="Arial" font-size="8" text-anchor="middle">Image Processing</text>
  <text x="400" y="250" font-family="Arial" font-size="8" text-anchor="middle">Visual Features</text>
  
  <rect x="480" y="200" width="100" height="80" rx="3" ry="3" fill="#ffe0b2" stroke="#e65100" stroke-width="1" />
  <text x="530" y="220" font-family="Arial" font-size="9" font-weight="bold" text-anchor="middle">HuBERT Audio</text>
  <text x="530" y="235" font-family="Arial" font-size="8" text-anchor="middle">Audio Processing</text>
  <text x="530" y="250" font-family="Arial" font-size="8" text-anchor="middle">Hidden Size: 768</text>
  
  <!-- Hidden States Output -->
  <rect x="235" y="310" width="70" height="20" rx="3" ry="3" fill="#ffcc80" stroke="#e65100" stroke-width="1" />
  <text x="270" y="324" font-family="Arial" font-size="8" text-anchor="middle">H(text) ∈ ℝ^(N×2048)</text>
  
  <rect x="365" y="310" width="70" height="20" rx="3" ry="3" fill="#ffcc80" stroke="#e65100" stroke-width="1" />
  <text x="400" y="324" font-family="Arial" font-size="8" text-anchor="middle">H(img) ∈ ℝ^(M×2048)</text>
  
  <rect x="495" y="310" width="70" height="20" rx="3" ry="3" fill="#ffcc80" stroke="#e65100" stroke-width="1" />
  <text x="530" y="324" font-family="Arial" font-size="8" text-anchor="middle">H(audio) ∈ ℝ^(K×768)</text>
  
  <!-- Pooling Layer -->
  <rect x="200" y="345" width="400" height="60" rx="5" ry="5" fill="#f3e5f5" stroke="#4a148c" stroke-width="1.5" />
  <text x="400" y="360" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Attention Pooling</text>
  
  <rect x="235" y="370" width="70" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#4a148c" stroke-width="1" />
  <text x="270" y="387" font-family="Arial" font-size="8" text-anchor="middle">c(text) ∈ ℝ^(2048)</text>
  
  <rect x="365" y="370" width="70" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#4a148c" stroke-width="1" />
  <text x="400" y="387" font-family="Arial" font-size="8" text-anchor="middle">c(img) ∈ ℝ^(2048)</text>
  
  <rect x="495" y="370" width="70" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#4a148c" stroke-width="1" />
  <text x="530" y="387" font-family="Arial" font-size="8" text-anchor="middle">c(audio) ∈ ℝ^(768)</text>
  
  <!-- Projection Layer -->
  <rect x="200" y="420" width="400" height="35" rx="5" ry="5" fill="#e0f7fa" stroke="#006064" stroke-width="1.5" />
  <text x="270" y="442" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle">Projection</text>
  <text x="400" y="442" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle">LayerNorm</text>
  <text x="530" y="442" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle">L2 Normalization</text>
  
  <!-- Output Embedding -->
  <rect x="300" y="470" width="200" height="30" rx="5" ry="5" fill="#ff8a80" stroke="#c62828" stroke-width="1.5" />
  <text x="400" y="490" font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle">Unified Embedding e ∈ ℝ^(1024)</text>
  
  <!-- Arrows -->
  <!-- Input to processing -->
  <line x1="270" y1="90" x2="270" y2="115" stroke="#01579b" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="400" y1="90" x2="400" y2="115" stroke="#01579b" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="530" y1="90" x2="530" y2="115" stroke="#01579b" stroke-width="1.5" marker-end="url(#arrowhead)" />
  
  <!-- Prefix to encoders -->
  <line x1="270" y1="160" x2="270" y2="200" stroke="#1b5e20" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="400" y1="160" x2="400" y2="200" stroke="#1b5e20" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="530" y1="160" x2="530" y2="200" stroke="#1b5e20" stroke-width="1.5" marker-end="url(#arrowhead)" />
  
  <!-- Loss Components to Dynamic Loss -->
  <line x1="180" y1="245" x2="620" y2="245" stroke="#f57f17" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrowhead)" />
  
  <!-- Dynamic Loss to Encoder Section -->
  <line x1="620" y1="230" x2="600" y2="230" stroke="#880e4f" stroke-width="1.5" stroke-dasharray="4,3" />
  <line x1="600" y1="230" x2="600" y2="175" stroke="#880e4f" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrowhead)" />
  
  <!-- Encoders to hidden states -->
  <line x1="270" y1="280" x2="270" y2="310" stroke="#e65100" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="400" y1="280" x2="400" y2="310" stroke="#e65100" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="530" y1="280" x2="530" y2="310" stroke="#e65100" stroke-width="1.5" marker-end="url(#arrowhead)" />
  
  <!-- Hidden states to Attention pooling -->
  <line x1="270" y1="330" x2="270" y2="370" stroke="#4a148c" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="400" y1="330" x2="400" y2="370" stroke="#4a148c" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="530" y1="330" x2="530" y2="370" stroke="#4a148c" stroke-width="1.5" marker-end="url(#arrowhead)" />
  
  <!-- Attention pooling to projection -->
  <line x1="270" y1="395" x2="270" y2="420" stroke="#006064" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="400" y1="395" x2="400" y2="420" stroke="#006064" stroke-width="1.5" marker-end="url(#arrowhead)" />
  <line x1="530" y1="395" x2="530" y2="420" stroke="#006064" stroke-width="1.5" marker-end="url(#arrowhead)" />
  
  <!-- Projection to final output -->
  <line x1="400" y1="455" x2="400" y2="470" stroke="#c62828" stroke-width="1.5" marker-end="url(#arrowhead)" />
  
  <!-- Workflow Labels -->
  <text x="180" y="137" font-family="Arial" font-size="9" font-style="italic" fill="#555555">Task-specific prefixes</text>
  <text x="650" y="175" font-family="Arial" font-size="9" font-style="italic" fill="#555555">Dynamic loss selection</text>
  <text x="120" y="175" font-family="Arial" font-size="9" font-style="italic" fill="#555555">Available loss components</text>
  <text x="150" y="470" font-family="Arial" font-size="9" font-style="italic" fill="#555555">Modality-specific processing</text>
  <text x="650" y="470" font-family="Arial" font-size="9" font-style="italic" fill="#555555">Unified vector representation</text>
  
  <!-- Arrowhead definition -->
  <defs>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#333" />
    </marker>
  </defs>
</svg>
